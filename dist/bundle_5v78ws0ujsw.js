(()=>{"use strict";const e={messages:{},room:"1",servers:[],account:{name:"You",id:65565*Math.random()}};let n=0;function t(e,n){localStorage.setItem(e,JSON.stringify(n))}function r(e,n){n=n||null;const t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(t){return console.error(`Error parsing JSON for key ${e}:`,t),n}return n}e.messages=r("messages",{}),e.servers=r("servers",[{id:"1",nickname:"General",img:""}]),e.account=r("account",{}),e.account.name||function(){let n=null;for(;!n||0===n.trim().length;)n=prompt("Enter your name to continue:"),null===n&&alert("You must enter a name to use the chat.");e.account={name:n.trim(),id:Math.floor(65565*Math.random())},t("account",e.account)}();let o=document.getElementById("chat_div");if(o)console.warn("Chat div already exists, reloading page to avoid conflicts."),location.reload();else{for(let e=0;e<document.body.children.length;e++)document.body.children[e].style.display="none";document.body.insertAdjacentHTML("beforeend",'<div id="chat_div">\n    <div id="servers_div">\n        <div class="server" id="serveradd">\n            <img src="https://cdn-icons-png.flaticon.com/512/1237/1237946.png" alt="Add Server" />\n        </div>\n    </div>\n    <div id="chat_inner_div">\n        <div id="message_input_div">\n            <textarea id="msg_input" rows="4" maxlength="2048" style="width: 100%; overflow: auto;"\n                placeholder="Enter up to 2048 characters...">\n            </textarea>\n            <button id="msg_send">\n                <img id="msg_send_img" src="https://cdn-icons-png.flaticon.com/512/3682/3682321.png" alt="Send" />\n            </button>\n        </div>\n    </div>\n    <div id="info_floater"></div>\n</div>');const e=document.createElement("style");e.textContent="#servers_div {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 75px;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background-color: #4f4f4f;\n    overflow-y: scroll;\n}\n\n#info_floater {\n    position: absolute;\n    bottom: 0px;\n    left: 0px;\n    max-width: 75px;\n    z-index: 1000;\n    background-color: rgba(0, 0, 0, 0.25);\n    color: rgba(105, 105, 105, 0.75);\n    font-family: Arial, sans-serif;\n}\n\n.server img {\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    border-radius: 9999px;\n    object-fit: cover;\n    object-position: center;\n}\n\n.server {\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    padding: 10px;\n    box-sizing: border-box;\n    border-radius: 9999px;\n    background-color: #444;\n    margin: 5px 0;\n    color: white;\n    text-align: center;\n    display: flex;\n    align-items: column;\n    justify-content: center;\n    cursor: pointer;\n}\n\n.server.selected {\n    outline: 2px solid limegreen;\n}\n\n#chat_inner_div {\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    width: calc(100% - 75px);\n    height: 100%;\n    overflow-y: scroll;\n    background-color: white;\n    display: flex;\n    align-items: left;\n    flex-direction: column;\n}\n\n.msg {\n    width: 100%;\n    padding: 10px;\n    box-sizing: border-box;\n    border-radius: 9999px;\n    background-color: #f1f1f1;\n    margin: 5px 0;\n    position: relative;\n    font-family: Arial, sans-serif;\n    color: #333;\n}\n\n#message_input_div {\n    position: absolute;\n    bottom: 0px;\n    right: 0px;\n    width: 100%;\n    height: 100px;\n    border-radius: 9999px;\n    display: flex;\n    align-items: center;\n    flex-direction: row;\n}\n\n#msg_input {\n    margin-right: 10px;\n    width: 100%;\n    height: 100%;\n    border-radius: 9999px;\n}\n\n#msg_send {\n    margin-right: 10px;\n    aspect-ratio: 1 / 1;\n    height: 100%;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    border: none;\n    background: none;\n    cursor: pointer;\n}\n\n#msg_send_img {\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    object-fit: cover;\n    object-position: center;\n}\n\n#chat_div {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    z-index: 0;\n    background-color: #777;\n}",document.head.appendChild(e)}function s(n,r,o,s){let i,a;e.messages[s]||(e.messages[s]=[]);try{i=JSON.parse(o)}catch(e){return void console.error("Invalid JSON msg:",e.message)}try{a=JSON.parse(r)}catch(e){return void console.error("Invalid JSON acc:",e.message)}a&&i?(console.log(`Received message in room ${s}:`,{timestamp:n,parsed_account:a,parsed_message:i}),e.messages[s].push({timestamp:n,account:a,message:i}),t("messages",e.messages)):console.error("Parsed account or message is null",r,o)}o=document.getElementById("chat_div");const i=document.getElementById("msg_input"),a=document.getElementById("msg_send"),c=document.getElementById("chat_inner_div"),d=document.getElementById("servers_div"),l=document.getElementById("serveradd");function m(t,r){return function(){n=0;for(let e=c.children.length-1;e>=0;e--){const n=c.children[e];n.id.startsWith("msg_")&&n.remove()}e.room=t,console.log("Changed room to:",t),e.messages[t]=e.messages[t]||[],e.servers.forEach((function(e){let n=document.getElementById("server_"+e.id);n&&n.classList.remove("selected")})),r&&r.classList.add("selected")}}document.getElementById("info_floater").innerHTML="<strong>v1.0.0</strong><br>\n    <strong>Build:</strong> 5v78ws0ujsw<br>",a.onclick=function(){let n=i.value;var t,r,o,a;n&&(i.value="",t=Date.now(),r=JSON.stringify(e.account),o=JSON.stringify({text:n}),a=e.room,send(t,r,o,a),s(t,r,o,a))},l.onclick=function(){let n,r,o;for(;!n;)n=prompt("Enter server name:");for(;!r;)r=prompt("Enter server ID:");o=prompt("Enter server image URL (optional):",""),e.servers.push({id:r,nickname:n,img:o}),t("servers",e.servers)},o.addEventListener("contextmenu",(function(r){const o=r.target.closest('[id^="server_"]');if(o&&2===r.button){r.preventDefault();const s=o.id.replace("server_",""),i=e.servers.findIndex((e=>e.id===s));if(-1!==i){const r=e.servers.splice(i,1)[0];t("servers",e.servers),document.getElementById("servers_div").removeChild(o),console.log(`Server ${r.nickname} removed.`),e.room===s&&(e.room=e.servers.length>0?e.servers[0].id:"1",n=0,c.innerHTML=""),document.querySelectorAll(".server").forEach((e=>e.classList.remove("selected")));const a=document.getElementById("server_"+e.room);a&&a.classList.add("selected")}}})),window.get=s,requestAnimationFrame((function t(){if(!o)return console.warn("Main div not found, reloading page to avoid conflicts."),void location.reload();const r=e.messages[e.room]||[];for(let e=n;e<r.length;e++){let n=r[e],t=document.createElement("div");t.className="msg",t.id="msg_"+e,t.innerHTML=`<strong>${n.account.name}</strong> \n            <span class="timestamp">${new Date(n.timestamp).toLocaleTimeString()}</span><br>\n            ${n.message.text}`,c.appendChild(t)}n=r.length,e.servers.forEach((function(e,n){let t=document.getElementById("server_"+e.id),r=`${e.img?`<img src="${e.img}" alt="${e.nickname}">`:""} ${e.nickname}`;t?(t.innerHTML=r,t.onclick=m(e.id,t)):(t=document.createElement("div"),t.className="server",t.id="server_"+e.id,t.className="server",t.innerHTML=r,t.onclick=m(e.id,t),d.insertBefore(t,d.lastChild))})),requestAnimationFrame(t)}))})();