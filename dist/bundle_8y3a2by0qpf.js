(()=>{"use strict";const n={messages:{},room:"1",servers:[],account:{name:"You",id:65565*Math.random()}};let e=0;function t(n,e){localStorage.setItem(n,JSON.stringify(e))}function o(n,e){e=e||null;const t=localStorage.getItem(n);if(t)try{return JSON.parse(t)}catch(t){return console.error(`Error parsing JSON for key ${n}:`,t),e}return e}n.messages=o("messages",{}),n.servers=o("servers",[{id:"1",nickname:"General",img:""}]),n.account=o("account",{}),n.account.name||function(){let e=null;for(;!e||0===e.trim().length;)e=prompt("Enter your name to continue:"),null===e&&alert("You must enter a name to use the chat.");n.account={name:e.trim(),id:Math.floor(65565*Math.random())},t("account",n.account)}();let r=document.getElementById("chat_div");if(r)console.warn("Chat div already exists, reloading page to avoid conflicts."),location.reload();else{for(let n=0;n<document.body.children.length;n++)document.body.children[n].style.display="none";document.body.insertAdjacentHTML("beforeend",'<div id="chat_div">\n    <div id="servers_div">\n        <div class="server" id="serveradd">\n            <img src="https://cdn-icons-png.flaticon.com/512/1237/1237946.png" alt="Add Server" />\n        </div>\n    </div>\n    <div id="chat_inner_div">\n        <div id="msg_input_div">\n            <textarea id="msg_input" rows="4" maxlength="2048" style="width: 100%; overflow: auto;"\n                placeholder="Enter up to 2048 characters...">\n            </textarea>\n            <button id="msg_send">\n                <img id="msg_send_img" src="https://cdn-icons-png.flaticon.com/512/3682/3682321.png" alt="Send" />\n            </button>\n        </div>\n    </div>\n    <div id="info_floater"></div>\n</div>');const n=document.createElement("style");n.textContent="#servers_div {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 75px;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background-color: #4f4f4f;\n    overflow-y: scroll;\n}\n\n#info_floater {\n    position: absolute;\n    bottom: 0px;\n    left: 0px;\n    max-width: 75px;\n    z-index: 1000;\n    background-color: rgba(0, 0, 0, 0.25);\n    color: rgba(105, 105, 105, 0.75);\n    font-family: Arial, sans-serif;\n}\n\n.server img {\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    border-radius: 9999px;\n    object-fit: cover;\n    object-position: center;\n}\n\n.server {\n    width: 100%;\n    aspect-ratio: 1 / 1;\n    padding: 10px;\n    box-sizing: border-box;\n    border-radius: 9999px;\n    background-color: #444;\n    margin: 5px 0;\n    color: white;\n    text-align: center;\n    display: flex;\n    align-items: column;\n    justify-content: center;\n    cursor: pointer;\n}\n\n.server.selected {\n    outline: 2px solid limegreen;\n}\n\n#chat_inner_div {\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    width: calc(100% - 75px);\n    height: 100%;\n    overflow-y: scroll;\n    background-color: white;\n    display: flex;\n    align-items: left;\n    flex-direction: column;\n}\n\n.msg {\n    width: 100%;\n    padding: 10px;\n    box-sizing: border-box;\n    border-radius: 9999px;\n    background-color: #f1f1f1;\n    margin: 5px 0;\n    position: relative;\n    font-family: Arial, sans-serif;\n    color: #333;\n}\n\n#msg_input_div {\n    position: absolute;\n    bottom: 0px;\n    right: 0px;\n    width: 100%;\n    height: 3%;\n    border-radius: 9999px;\n    display: flex;\n    align-items: center;\n    flex-direction: row;\n}\n\n#msg_input {\n    margin-right: 10px;\n    width: 100%;\n    height: 100%;\n    border-radius: 9999px;\n}\n\n#msg_send {\n    margin-right: 10px;\n    aspect-ratio: 1 / 1;\n    height: 100%;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    border: none;\n    background: none;\n    cursor: pointer;\n}\n\n#msg_send_img {\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    object-fit: cover;\n    object-position: center;\n}\n\n#chat_div {\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    width: 100%;\n    height: 100%;\n    z-index: 0;\n    background-color: #777;\n}",document.head.appendChild(n)}r=document.getElementById("chat_div");const i=document.getElementById("msg_input"),s=document.getElementById("msg_send"),a=document.getElementById("chat_inner_div"),c=document.getElementById("servers_div"),d=document.getElementById("serveradd");function l(t,o){return function(){e=0,a.innerHTML="",n.room=t,console.log("Changed room to:",t),n.messages[t]=n.messages[t]||[],n.servers.forEach((function(n){let e=document.getElementById("server_"+n.id);e&&e.classList.remove("selected")})),o&&o.classList.add("selected")}}document.getElementById("info_floater").innerHTML="<strong>v1.0.0</strong><br>\n    <strong>Build:</strong> 8y3a2by0qpf<br>",s.onclick=function(){let e=i.value;var o,r,s,a;e&&(i.value="",o=Date.now(),r=JSON.stringify(n.account),s=JSON.stringify({text:e}),a=n.room,send(o,r,s,a),function(e,o,r,i){let s,a;n.messages[i]||(n.messages[i]=[]);try{s=JSON.parse(r)}catch(n){return void console.error("Invalid JSON msg:",n.message)}try{a=JSON.parse(o)}catch(n){return void console.error("Invalid JSON acc:",n.message)}a&&s?(console.log(`Received message in room ${i}:`,{timestamp:e,parsed_account:a,parsed_message:s}),n.messages[i].push({timestamp:e,account:a,message:s}),t("messages",n.messages)):console.error("Parsed account or message is null",o,r)}(o,r,s,a))},d.onclick=function(){let e,o,r;for(;!e;)e=prompt("Enter server name:");for(;!o;)o=prompt("Enter server ID:");r=prompt("Enter server image URL (optional):",""),n.servers.push({id:o,nickname:e,img:r}),t("servers",n.servers)},requestAnimationFrame((function t(){if(!r)return console.warn("Main div not found, reloading page to avoid conflicts."),void location.reload();const o=n.messages[n.room]||[];for(let n=e;n<o.length;n++){let e=o[n],t=document.createElement("div");t.className="msg",t.id="msg_"+n,t.innerHTML=`<strong>${e.account.name}</strong> \n            <span class="timestamp">${new Date(e.timestamp).toLocaleTimeString()}</span><br>\n            ${e.message.text}`,a.appendChild(t)}e=o.length,n.servers.forEach((function(n,e){let t=document.getElementById("server_"+e),o=`${n.img?`<img src="${n.img}" alt="${n.nickname}">`:""} ${n.nickname}`;t?(t.innerHTML=o,t.onclick=l(n.id)):(t=document.createElement("div"),t.className="server",t.id="server_"+e,t.className="server",t.innerHTML=o,t.onclick=l(n.id),c.insertBefore(t,c.lastChild))})),requestAnimationFrame(t)})),document.getElementById("server_"+n.room).classList.add("selected")})();